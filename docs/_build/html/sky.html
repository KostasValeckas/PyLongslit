<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Modelled sky subtraction &#8212; PyLongslit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2D Spectrum Viewer" href="show_2dspec.html" />
    <link rel="prev" title="Cropping of images" href="crop.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="modelled-sky-subtraction">
<span id="sky"></span><h1>Modelled sky subtraction<a class="headerlink" href="#modelled-sky-subtraction" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For some datasets, if you already have subtracted the sky bacground by using
<a class="reference internal" href="AB.html#ab"><span class="std std-ref">A-B background subtraction</span></a>, you might be able to skip this step.
This is the case for the SDSS_J213510+2728 tutorial dataset, where the sky
subtraction by the A-B method is so succesfull, that practically all background
is removed. However, for some datasets, you will need to perform this step
even if you have already subtracted the sky background by the A-B method -
inspect the files after the A-B routine to see if there is any remaining sky background.
It is imortant to note that any procedure performed in the pipeline introduces
some error noise (see <a class="reference internal" href="uncertainties.html#uncertainties"><span class="std std-ref">note on uncertainties</span></a>), so you must consider what is your best option, or test different
approaches.</p>
</div>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">¶</a></h2>
<p>The procedure is called by the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pylongslit_sky_subtract<span class="w"> </span>PATH_TO_CONFIG_FILE
</pre></div>
</div>
<p>The procedure will estimate a sky-model using polynomial fitting, and
subtract this model from the reduced files in the output directory specified in the
configuration file. The procedure will alter the reduced files in-place. There
are some interactive parts of the procedure, where you can also skip sky-subtraction
for certain frames if you wish - this is explained in more detail below.</p>
<p>The procedure will start by plotting all the reduced frames one at a time, and
you will have to mark the object center by clicking on the object trace. You can also
choose to skip the sky-subtraction of a frame by not clicking on the object trace
and simply closing the window. Below is an example of the interactive window for the
GQ1218+0832 dataset, with prior and after object choice:</p>
<a class="reference internal image-reference" href="_images/sky_prior.png"><img alt="_images/sky_prior.png" class="align-center" src="_images/sky_prior.png" style="width: 100%;" />
</a>
<a class="reference internal image-reference" href="_images/sky_post.png"><img alt="_images/sky_post.png" class="align-center" src="_images/sky_post.png" style="width: 100%;" />
</a>
<p>From then on, the procedure will estimate the sky background using polynomial fitting, and subtract it.</p>
</section>
<section id="quality-assesment">
<h2>Quality Assesment<a class="headerlink" href="#quality-assesment" title="Link to this heading">¶</a></h2>
<p>The routine fits a polynomial to the sky background for every spectral pixel. A
sample for one fit (corresponsing to the coordinates of the manually chosen object center) will be
shown for quality assesment:</p>
<a class="reference internal image-reference" href="_images/sky_QA.png"><img alt="_images/sky_QA.png" class="align-center" src="_images/sky_QA.png" style="width: 100%;" />
</a>
<p>A good fit is defined by:</p>
<ol class="arabic simple">
<li><p>Random residual spread around 0.</p></li>
<li><p>Very strong outliers rejected.</p></li>
<li><p>The object is encapsulated completely by the red lines.</p></li>
</ol>
<p>The software will then plot the whole sky model:</p>
<a class="reference internal image-reference" href="_images/sky_model.png"><img alt="_images/sky_model.png" class="align-center" src="_images/sky_model.png" style="width: 100%;" />
</a>
<p>And the observation frames before and after subtraction:</p>
<a class="reference internal image-reference" href="_images/sky_original.png"><img alt="_images/sky_original.png" class="align-center" src="_images/sky_original.png" style="width: 100%;" />
</a>
<a class="reference internal image-reference" href="_images/sky_subtracted.png"><img alt="_images/sky_subtracted.png" class="align-center" src="_images/sky_subtracted.png" style="width: 100%;" />
</a>
<p>The subtracted frame should show a clear reduction of the sky background, with the
remaining background being mostly noise. The object should be clearly visible after subtraction, and should not
be present in the sky-model.</p>
</section>
<section id="parameter-options">
<h2>Parameter options<a class="headerlink" href="#parameter-options" title="Link to this heading">¶</a></h2>
<p>These parameters can be adjusted in the configuration file to control the fit,
with example values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sky&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;sigma_cut&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;sigma_clip_iters&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;fit_order&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">},</span>

<span class="s2">&quot;trace&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fwhm_guess&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_thresh&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fwhm_guess&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_thresh&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;sigma_cut&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;sigma_clip_iters&quot;</span></code> parameters control the rejection of outliers in the sky model fitting.
They are passed to <a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.stats.sigma_clip.html">astropy.stats.sigma_clip</a> ,
where <code class="docutils literal notranslate"><span class="pre">&quot;sigma_cut&quot;</span></code> is the number of standard deviations to use for the rejection, and <code class="docutils literal notranslate"><span class="pre">&quot;sigma_clip_iters&quot;</span></code>
is the maximum number of iterations to perform (stops earlier if convergence is reached).
The <code class="docutils literal notranslate"><span class="pre">&quot;fit_order&quot;</span></code> parameter decides what order polynomial to fit to the sky background.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;fwhm_guess&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;fwhm_thresh&quot;</span></code> parameters are used to estimate the limits of the objects
(can be set different for science and standard star frames). The red lines you see on the plot
above are defined as: object center +/- 3 <code class="docutils literal notranslate"><span class="pre">&quot;fwhm_guess&quot;</span></code> +/- <code class="docutils literal notranslate"><span class="pre">&quot;fwhm_thresh&quot;</span></code> (in pixels).</p>
</section>
<section id="for-users-new-to-data-reduction-short-introduction-to-sky-background">
<h2>For users new to data reduction - short introduction to sky background<a class="headerlink" href="#for-users-new-to-data-reduction-short-introduction-to-sky-background" title="Link to this heading">¶</a></h2>
<p>Sky background is the light from the sky and the atmosphere that is recorded by the detector together
with the object spectrum. This background light covers
the whole slit, and the bacground therefore shows itself as lines through the whole spatial direction
(see above figures). The sky background consists both of strong sky lines (emission lines from the sky) and
a continuum background. These sky lines/background are mixed into the object signal, and must be removed.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyLongslit</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Getting started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#downloading-the-tutorial-data">Downloading the tutorial data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="getting_started.html#tutorial">Tutorial</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="general_notes.html">General Notes on using the pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration_file.html">Configuration file</a></li>
<li class="toctree-l3"><a class="reference internal" href="bias.html">Bias</a></li>
<li class="toctree-l3"><a class="reference internal" href="dark_current.html">Dark current subtraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="combine_arcs.html">Combinning arc frames</a></li>
<li class="toctree-l3"><a class="reference internal" href="identify.html">Identify arc lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="wavecalib.html">Wavelength Calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="flat.html">Flat-field</a></li>
<li class="toctree-l3"><a class="reference internal" href="reduce.html">Reduction of observations</a></li>
<li class="toctree-l3"><a class="reference internal" href="crr.html">Cosmic ray removal</a></li>
<li class="toctree-l3"><a class="reference internal" href="AB.html">A-B Background subtraction</a></li>
<li class="toctree-l3"><a class="reference internal" href="crop.html">Cropping of images</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Modelled sky subtraction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quality-assesment">Quality Assesment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parameter-options">Parameter options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#for-users-new-to-data-reduction-short-introduction-to-sky-background">For users new to data reduction - short introduction to sky background</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="show_2dspec.html">2D Spectrum Viewer</a></li>
<li class="toctree-l3"><a class="reference internal" href="objtrace.html">Object Tracing</a></li>
<li class="toctree-l3"><a class="reference internal" href="extract_1d.html">Extracting 1D spectrum</a></li>
<li class="toctree-l3"><a class="reference internal" href="sensfunction.html">Sensitivity function</a></li>
<li class="toctree-l3"><a class="reference internal" href="calibrate.html">Flux calibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="combine_spec.html">Combining the spectra</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="uncertainties.html">Note on how the software estimates uncertainties</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="getting_started.html">Getting started</a><ul>
      <li>Previous: <a href="crop.html" title="previous chapter">Cropping of images</a></li>
      <li>Next: <a href="show_2dspec.html" title="next chapter">2D Spectrum Viewer</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/sky.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>