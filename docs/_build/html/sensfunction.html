<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sensitivity function &#8212; PyLongslit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Flux calibration" href="calibrate.html" />
    <link rel="prev" title="Extracting 1D spectrum" href="extract_1d.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="sensitivity-function">
<span id="sensfunction"></span><h1>Sensitivity function<a class="headerlink" href="#sensitivity-function" title="Link to this heading">¶</a></h1>
<p>This procedure is used to obtain a sensitivity function. The sensitivity function
is essentially a conversion factor between observed counts pr. second and flux in physical units.
For further explanation, see the <a class="reference internal" href="#sensfunction-math"><span class="std std-ref">further description of the sensitivity function</span></a>.</p>
<section id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Link to this heading">¶</a></h2>
<p>The routine is called by the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pylongslit_sensitivity_function<span class="w"> </span>PATH_TO_CONFIG_FILE
</pre></div>
</div>
<p>The procedure will first show the extinction curve and the transmission factor:</p>
<a class="reference internal image-reference" href="_images/transmission_fact.png"><img alt="_images/transmission_fact.png" class="align-center" src="_images/transmission_fact.png" style="width: 100%;" />
</a>
<p>For how this is calculated, and how it is used, please see the
<a class="reference internal" href="#transmission-factor"><span class="std std-ref">description of the extinction curve and the transmission factor</span></a>.
The transmission factor should be <code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">1.0</span></code> for all wavelengths.</p>
<p>The routine will then calculate the sensitivity points in log-space
(see <a class="reference internal" href="#sensfunction-math"><span class="std std-ref">math behind the sensitivity function</span></a>), and
you can crop away any noisy edges that would corrupt later fitting (taken from
the SDSS_J213510+2728 example dataset - with recommended cropping shown):</p>
<a class="reference internal image-reference" href="_images/sens_crop_prior.png"><img alt="_images/sens_crop_prior.png" class="align-center" src="_images/sens_crop_prior.png" style="width: 100%;" />
</a>
<a class="reference internal image-reference" href="_images/sens_crop_past.png"><img alt="_images/sens_crop_past.png" class="align-center" src="_images/sens_crop_past.png" style="width: 100%;" />
</a>
<p>Further, a following interactive plot will allow you to mask any strong
emission/absorption lines that would corrupt later fitting, by clicking on them
(with recommended amount of masking shown):</p>
<a class="reference internal image-reference" href="_images/sens_mask_prior.png"><img alt="_images/sens_mask_prior.png" class="align-center" src="_images/sens_mask_prior.png" style="width: 100%;" />
</a>
<a class="reference internal image-reference" href="_images/sens_mask_post.png"><img alt="_images/sens_mask_post.png" class="align-center" src="_images/sens_mask_post.png" style="width: 100%;" />
</a>
<p>A polynomial fit will then be performed to the sensitivity points:</p>
<a class="reference internal image-reference" href="_images/sens_fit.png"><img alt="_images/sens_fit.png" class="align-center" src="_images/sens_fit.png" style="width: 100%;" />
</a>
<p>The goal is to see a smooth fit with mostly random residual distribution around zero.
However, the star spectrum will still have some artifacts such as absorption lines from the sky,
and these might show up as structures in the residual plot. Make sure that these are small compared
to the general order of magnitude of the data</p>
<p>The parameters that can control the fit are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;sensfunc&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;fit_order&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;use_bspline&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;knots_bspline&quot;</span><span class="p">:</span> <span class="mi">15</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;fit</span> <span class="pre">order&quot;</span></code> is the order of the polynomial fit. If <code class="docutils literal notranslate"><span class="pre">&quot;use_bspline&quot;</span></code> is set to <code class="docutils literal notranslate"><span class="pre">true</span></code>,
a B-spline fit will be performed instead of a regular polynomial. This should only be done if regular
polynomial fit fails. The number of knots in the B-spline fit is set by
<code class="docutils literal notranslate"><span class="pre">&quot;knots_bspline&quot;</span></code> - you should use as few knots as possible to avoid overfitting.</p>
<p>Lastly, a final QA plot will be shown, where the reference standard star spectrum is plotted
together with the observed standard star spectrum, now flux-calibrated with the fitted sensitivity function
(from the SDSS_J213510+2728 example dataset):</p>
<a class="reference internal image-reference" href="_images/flux_QA.png"><img alt="_images/flux_QA.png" class="align-center" src="_images/flux_QA.png" style="width: 100%;" />
</a>
<p>The two spectra should resemble each other closely, but you might see some
deviations at the edges. If the two spectra are very different, you
will unfortunetly have to revise the whole pipeline process up to this point,
as the fault might be both in the sensitivity function and in the previous steps
ending with the <a class="reference internal" href="extract_1d.html#extract-1d"><span class="std std-ref">1d extraction</span></a>.</p>
<p>If the two spectra are similar, you can accept this as a strong indication that
the pipeline run until this point has been successful.</p>
<p>You can see the chater about <a class="reference internal" href="calibrate.html#flux-calibrate"><span class="std std-ref">flux calibration</span></a> on how
the standard star gets calibrated with the sensitivity function. Yo will have
to set these parameters to get a succesful calibration (with example values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;standard&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;exptime&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="s2">&quot;airmass&quot;</span><span class="p">:</span> <span class="mf">1.0421315680187</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;exptime&quot;</span></code> is the exposure time of the standard star observation, and the <code class="docutils literal notranslate"><span class="pre">&quot;airmass&quot;</span></code> is the airmass
of the standard star observation.</p>
<p>The sensitivity function is saved in the output directory defined in the configuration file
in machine-readable format, with the filename <code class="docutils literal notranslate"><span class="pre">sensfunc.dat</span></code>.</p>
</section>
<section id="the-reference-spectrum">
<span id="reference-spectrum"></span><h2>The reference spectrum<a class="headerlink" href="#the-reference-spectrum" title="Link to this heading">¶</a></h2>
<p>In order to produce a sensitivity function, you will need to have a flux-calibrated spectrum of the
standard star you have observed <strong>in AB magnitude units</strong>. For the tutorial data,
these are already provided.</p>
<p>For the <a class="reference external" href="https://github.com/KostasValeckas/PyLongslit_dev/blob/main/database/bd33a.oke">SDSS_J213510+2728</a>
example dataset, the standard star is <code class="docutils literal notranslate"><span class="pre">BD332642</span></code>, and the flux file is taken from:
<a class="reference external" href="https://www.ing.iac.es/Astronomy/observing/manuals/html_manuals/tech_notes/tn065-100/bd33.html">https://www.ing.iac.es/Astronomy/observing/manuals/html_manuals/tech_notes/tn065-100/bd33.html</a>.</p>
<p>For the <a class="reference external" href="https://github.com/KostasValeckas/PyLongslit_dev/blob/main/database/mfeige110.dat">GQ1218+0832</a>
example dataset, the standard star is <code class="docutils literal notranslate"><span class="pre">Feige110</span></code>, and the flux file is taken from:
<a class="reference external" href="https://www.ing.iac.es/Astronomy/observing/manuals/html_manuals/tech_notes/tn065-100/f110.htmls">https://www.ing.iac.es/Astronomy/observing/manuals/html_manuals/tech_notes/tn065-100/f110.htmls</a>.</p>
<p>The path to the reference spectrum is set in the configuration file, under the parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;standard&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;starname&quot;</span><span class="p">:</span> <span class="s2">&quot;BD332642&quot;</span><span class="p">,</span>
    <span class="s2">&quot;flux_file_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/kostas/Documents/PyLongslit_dev/database/bd33a.oke&quot;</span>

<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;starname&quot;</span></code> parameter is used for logging only. The refrence spectrum file should have
two columns: wavelength and flux in AB magnitude units.</p>
</section>
<section id="extinction-curve-and-the-transmission-factor">
<span id="transmission-factor"></span><h2>Extinction curve and the transmission factor<a class="headerlink" href="#extinction-curve-and-the-transmission-factor" title="Link to this heading">¶</a></h2>
<p>You will need to provide an extinction curve <strong>in AB magnitude/airmass units</strong> for the observatory your
data was taken at. The extinction curve is a function of wavelength that describes how much
light is absorbed by the Earth’s atmosphere at the observatory. The
<a class="reference external" href="https://github.com/KostasValeckas/PyLongslit_dev/blob/main/database/lapalma.dat">extinction curve for the example data</a>
is provided in the same file, as both datasets are taken from the Roque de los Muchachos Observatory.
The extinction curve is taken from:
<a class="reference external" href="https://www.ing.iac.es/Astronomy/observing/manuals/html_manuals/wht_instr/pfip/node244.html">https://www.ing.iac.es/Astronomy/observing/manuals/html_manuals/wht_instr/pfip/node244.html</a>.</p>
<p>The path to the extinction curve is set in the configuration file, under the parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;flux_calib&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;path_extinction_curve&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/kostas/Documents/PyLongslit_dev/database/lapalma.dat&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The extinction curve is used to estimate a
<strong>transmission factor</strong>. This factor describes the relationship
between the observed flux and the real flux:</p>
<div class="math notranslate nohighlight">
\[\frac{F_{\text{true}}}{F_{\text{obs}}} = 10^{0.4 \cdot A \cdot X} ,\]</div>
<p>where <span class="math notranslate nohighlight">\(F_{\text{true}}\)</span> is the true flux, <span class="math notranslate nohighlight">\(F_{\text{obs}}\)</span> is the observed flux,
<span class="math notranslate nohighlight">\(A\)</span> is the extinction, and <span class="math notranslate nohighlight">\(X\)</span> is the airmass.</p>
</section>
<section id="math-behind-the-sensitivity-function">
<span id="sensfunction-math"></span><h2>Math behind the sensitivity function<a class="headerlink" href="#math-behind-the-sensitivity-function" title="Link to this heading">¶</a></h2>
<p>When flux-calibrating the <a class="reference internal" href="extract_1d.html#extract-1d"><span class="std std-ref">extracted 1d-spectrum</span></a> from detector counts,
a sensitivity function needs to be obtained first.
This function is obtained by fitting a model to an array of sensitivity points <span class="math notranslate nohighlight">\(S_{points}(\lambda)\)</span>.
These points are obtained by dividing a flux-calibrated spectrum of a standard star
(that is in the wanted units) with the obtained 1d-spectrum in counts per second
of the same star. In PyLongslit default units:</p>
<div class="math notranslate nohighlight">
\[S_{points}(\lambda) \left[\frac{\text{erg}/\text{cm}^2/\text{Å}}{\text{counts}}\right] =
\frac{\text{1d-spec flux-calibrated spectrum} \left[\text{erg}/\text{s}/\text{cm}^2/\text{Å}\right]}{\text{1d-spec observed spectrum in counts per second} \left[\text{counts}/\text{s}\right]} \ \ .\]</div>
<p>Fitting a model to these points gives the conversion factor (sensitivity function) <span class="math notranslate nohighlight">\(S(\lambda)\)</span> between observed counts per second <span class="math notranslate nohighlight">\(C_{1d}(\lambda)/s\)</span> to flux in physical units <span class="math notranslate nohighlight">\(Flux(\lambda)\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-flux">
<span class="eqno">(1)<a class="headerlink" href="#equation-flux" title="Link to this equation">¶</a></span>\[Flux(\lambda) =  \frac{C_{1d}(\lambda)}{\text{exposure time}} \ S(\lambda) \ \ .\]</div>
<p>In the software, the fit for <span class="math notranslate nohighlight">\(S(\lambda)\)</span> is performed in (10-base) log-space (<span class="math notranslate nohighlight">\(S_{log}(\lambda)\)</span>).
This is because the observed 1d-standard star spectrum in counts will still have
some artifacts such as absorption lines from the sky, and these might corrupt the fit.
Fitting in logarithmic space scales these artifacts down.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyLongslit</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Getting started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#downloading-the-tutorial-data">Downloading the tutorial data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="getting_started.html#tutorial">Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tested_instruments.html">Tested Instruments and Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="special_use_cases.html">Special Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Interested in developing?</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainties.html">Note on how the software estimates uncertainties</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="getting_started.html">Getting started</a><ul>
      <li>Previous: <a href="extract_1d.html" title="previous chapter">Extracting 1D spectrum</a></li>
      <li>Next: <a href="calibrate.html" title="next chapter">Flux calibration</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/sensfunction.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>