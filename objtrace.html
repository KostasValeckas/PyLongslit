<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Object Tracing &#8212; PyLongslit  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Extracting 1D spectrum" href="extract_1d.html" />
    <link rel="prev" title="2D Spectrum Viewer" href="show_2dspec.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="object-tracing">
<span id="objtrace"></span><h1>Object Tracing<a class="headerlink" href="#object-tracing" title="Link to this heading">¶</a></h1>
<p>In this routine the software estimate at what pixels the object is located in the 2D spectrum.</p>
<p>There are 3 ways to trace the object in the software:</p>
<ol class="arabic simple">
<li><p><strong>Profile fitting</strong>: This is the default method.</p></li>
<li><p><strong>Cloning a trace</strong>: This is done by re-using an earlier obtained trace.</p></li>
<li><p><strong>Manual tracing</strong>: This is done by hand.</p></li>
</ol>
<p>All of these are described below.</p>
<section id="profile-fitting">
<span id="profile"></span><h2>Profile fitting<a class="headerlink" href="#profile-fitting" title="Link to this heading">¶</a></h2>
<p>The routine is called by the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pylongslit_objtrace<span class="w"> </span>PATH_TO_CONFIG_FILE
</pre></div>
</div>
<p>The routine will fit a user chosen profile to the object in the 2D spectrum.
There are a few interactive steps in the routine.</p>
<p>Firstly, you will have to choose the center of the object by clicking on it.
This is exactly the same routine as in <a class="reference internal" href="sky.html#sky"><span class="std std-ref">sky subtraction</span></a>, please see
the description there.</p>
<p>Then, the software will fit a 1d profile to every spatial column in the 2D spectrum.
A sample of the fits will be shown for you quality assesment (example here
is from the SDSS_J213510+2728 example dataset):</p>
<a class="reference internal image-reference" href="_images/spacial_fit.png"><img alt="_images/spacial_fit.png" class="align-center" src="_images/spacial_fit.png" style="width: 100%;" />
</a>
<p>The following parameters can be set in the configuration file to control the fitting
(with example values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;trace&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;spectral_pixel_extension&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_guess&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_thresh&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;center_thresh&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;fit_R2&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Gaussian&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;spectral_pixel_extension&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_guess&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;fwhm_thresh&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;center_thresh&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;fit_R2&quot;</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Gaussian&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The standard star and the science object have their own set of parameters, as
their shape can be different, but the meaning of the parameters is the same.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spectral_pixel_extension</span></code>: The number of pixels to average over for a single 1d slice. Ex. if the spectral pixel for the fit is 1500, and this parameter is set to 10, the software will average over the pixels 1490-1510. This can help with low-signal objects, but please be aware than if you average over too large values, you might miss some features in the object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwhm_guess</span></code>: The initial guess for the FWHM of the object. This is in pixels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fwhm_thresh</span></code>: The threshold for how much the FWHM can vary from the initial guess. This is in pixels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">center_thresh</span></code>: The threshold for how much the center of the object can vary from the maximum value in the 1d slice. This is in pixels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit_R2</span></code>: The minimum <span class="math notranslate nohighlight">\(R^2\)</span> value for the fit to be accepted. You can later manually crop out noisy edges, so it is okay to be a bit lenient here.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model</span></code>: The model to fit to the object. The options are: <code class="docutils literal notranslate"><span class="pre">&quot;Gaussian&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;Cauchy&quot;</span></code>. Gaussian is useful for point-like objects, while Cauchy is useful for extended objects. It is recommended that you use the same model for the standard star and the object, as none of the models are perfect representations of the object, so at least you will have the same systematic error in both when comparing counts to flux.</p></li>
</ul>
<p>Afterwards, you will be given the oppurtunity to crop out noisy edges of the trace:</p>
<a class="reference internal image-reference" href="_images/crop_image.png"><img alt="_images/crop_image.png" class="align-center" src="_images/crop_image.png" style="width: 100%;" />
</a>
<p>Here you can use the arrow keys to move the red lines if any of the excepted fits (green)
are false positives.</p>
<p>Lastly, the software will fit a polynomial to both the fitted centers and the fitted
FWHM values (fit only showed for centers, but FWHM is fitted in the same way):</p>
<a class="reference internal image-reference" href="_images/objtrace_fit.png"><img alt="_images/objtrace_fit.png" class="align-center" src="_images/objtrace_fit.png" style="width: 100%;" />
</a>
<p>The goal is random residuals around 0, with a smooth trace of the object.
These parameters can be changed to control the fitting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;trace&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fit_order_trace&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;fit_order_fwhm&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;use_bspline_obj&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;use_bspline_fwhm&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;knots_bspline&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;standard&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;fit_order_trace&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;fit_order_fwhm&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;use_bspline_obj&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;use_bspline_fwhm&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;knots_bspline&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">fit_order_trace</span></code>: The order of the polynomial to fit to the centers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fit_order_fwhm</span></code>: The order of the polynomial to fit to the FWHM values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_bspline_obj</span></code>: If you want to use a bspline for the centers. Should only be set t <code class="docutils literal notranslate"><span class="pre">true</span></code> if the regular polynomial does not give a good fit. Use as few knots as possible to get a good fit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_bspline_fwhm</span></code>: If you want to use a bspline for the FWHM values. Use with same caution as described above.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">knots_bspline</span></code>: The number of knots to use in the bspline.</p></li>
</ul>
<p>Finally, a quality assesment plot is created to show the 2d spectrum with the 2d
object trace overlaid:</p>
<a class="reference internal image-reference" href="_images/QA_objtrace.png"><img alt="_images/QA_objtrace.png" class="align-center" src="_images/QA_objtrace.png" style="width: 100%;" />
</a>
<p>If the object model does not fit the object well, revise the whole process, and take
extra good look at the earlier QA plots.</p>
<p>The trace is saved in the output directory defined in the configuration file,
and the filename is either <code class="docutils literal notranslate"><span class="pre">obj_science_FILENAME.dat</span></code> or <code class="docutils literal notranslate"><span class="pre">obj_standard_FILENAME.dat</span></code>.
In the file there are 3 columns: the spectral pixel, the center of the object, and the FWHM
of the object.</p>
</section>
<section id="cloning-a-trace">
<h2>Cloning a trace<a class="headerlink" href="#cloning-a-trace" title="Link to this heading">¶</a></h2>
<p>Sometimes there are several objects present on the detector. If you have issues
tracing your object of interest (if it is too faint, for example), you can clone
a trace from another object, if it is possible to fit a neibhoring object
instead.</p>
<p>You have to first set 2 parameters in the configuration file
(from the SDSS_J213510+2728 example dataset):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;obj_trace_clone&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;archived_spec_root&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/kostas/Documents/PyLongslit_dev/SDSS_J213510+2728/output/obj_science_ALHh080251.dat&quot;</span><span class="p">,</span>
    <span class="s2">&quot;frame_root&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/kostas/Documents/PyLongslit_dev/SDSS_J213510+2728/output/reduced_science_ALHh080252.fits&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">archived_spec_root</span></code>: The path to the trace you want to clone. There must be three columns in the file: the spectral pixel, the center of the object, and the FWHM of the object.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frame_root</span></code>: The path to the 2d spectrum you want to clone the trace to.</p></li>
</ul>
<p>Then you run the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pylongslit_objtrace_cloned<span class="w"> </span>PATH_TO_CONFIG_FILE
</pre></div>
</div>
<p>This will open an interactive plot where you can move the object trace through the
spatial axis (up/down) using the arrow keys:</p>
<a class="reference internal image-reference" href="_images/obj_clone.png"><img alt="_images/obj_clone.png" class="align-center" src="_images/obj_clone.png" style="width: 100%;" />
</a>
<p>You have to move the trace to match the center of the object you want to trace:</p>
<a class="reference internal image-reference" href="_images/cloned_zoom.png"><img alt="_images/cloned_zoom.png" class="align-center" src="_images/cloned_zoom.png" style="width: 100%;" />
</a>
<p>You will then be showed the same final QA plot as in the <a class="reference internal" href="#profile"><span class="std std-ref">profile fitting procedure</span></a>.</p>
<p>The file saving format is the same as in the <a class="reference internal" href="#profile"><span class="std std-ref">profile fitting procedure</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While cloning the object trace, you will clone the FWHM values as well.
This is not ideal, as the FWHM values can be different for different objects.
It is ususally best to clone an object where the archived object trace has larger FWHM than
the object you want to trace, instead of smaller. Larger FWHM will result in more noise, but it will trace
the whole object. Smaller FWHM will result in less noise, but it will miss
some of the object.</p>
</div>
</section>
<section id="manual-tracing">
<span id="man-trace"></span><h2>Manual tracing<a class="headerlink" href="#manual-tracing" title="Link to this heading">¶</a></h2>
<p>For traces that are too faint to be traced by the software or cannot be cloned,
you can always trace the object by hand.</p>
<p>The manual tracing is called by the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pylongslit_objtrace_manual<span class="w"> </span>PATH_TO_CONFIG_FILE
</pre></div>
</div>
<p>This will open an interactive plot where you can either skip the object by
closing the plot, or trace by hoovering the cursor over the object and clicking
<code class="docutils literal notranslate"><span class="pre">&quot;+&quot;</span></code> to add a point to the trace. Clickin <code class="docutils literal notranslate"><span class="pre">&quot;-&quot;</span></code> will remove the last point
added - and can be clicked multiple times to remove multiple points. You can press
<code class="docutils literal notranslate"><span class="pre">&quot;h&quot;</span></code> to toggle histogram normalization, and <code class="docutils literal notranslate"><span class="pre">&quot;c&quot;</span></code> to toggle the color map:</p>
<a class="reference internal image-reference" href="_images/manual_clean.png"><img alt="_images/manual_clean.png" class="align-center" src="_images/manual_clean.png" style="width: 100%;" />
</a>
<a class="reference internal image-reference" href="_images/manual_points.png"><img alt="_images/manual_points.png" class="align-center" src="_images/manual_points.png" style="width: 100%;" />
</a>
<p>The software will then perform the same routine as in the <a class="reference internal" href="#profile"><span class="std std-ref">profile fitting procedure</span></a>,
but with a constant FWHM value taken from the <code class="docutils literal notranslate"><span class="pre">fwhm_guess</span></code> parameter in the configuration file.
All the parameters are the same as in the <a class="reference internal" href="#profile"><span class="std std-ref">profile fitting procedure</span></a> and can be
set to control the fitting.</p>
<p>The file saving format is the same as in the <a class="reference internal" href="#profile"><span class="std std-ref">profile fitting procedure</span></a>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">PyLongslit</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Getting started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#downloading-the-tutorial-data">Downloading the tutorial data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="getting_started.html#tutorial">Tutorial</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tested_instruments.html">Tested Instruments and Configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="special_use_cases.html">Special Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Interested in developing?</a></li>
<li class="toctree-l1"><a class="reference internal" href="uncertainties.html">Note on how the software estimates uncertainties</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="getting_started.html">Getting started</a><ul>
      <li>Previous: <a href="show_2dspec.html" title="previous chapter">2D Spectrum Viewer</a></li>
      <li>Next: <a href="extract_1d.html" title="next chapter">Extracting 1D spectrum</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/objtrace.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>